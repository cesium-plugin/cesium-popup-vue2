(function(){"use strict";var e={5737:function(e,t,i){var n=i(5471),s=function(){var e=this,t=e._self._c;return t("router-view")},o=[],r={},a=r,l=i(1656),c=(0,l.A)(a,s,o,!1,null,null,null),h=c.exports,u=i(173),d=function(){var e=this,t=e._self._c;return t("CesiumMap")},p=[],m=function(){var e=this,t=e._self._c;return t("div",{ref:"mapRef",staticClass:"map"})},v=[],f=i(1114),g=i(2569),w=i(2403),y=i(6680),C=i(6946),A=i(7817),b=i(2085),T=i(8173),L=i(4067);class x{constructor(e){(0,f.A)(this,"viewer",void 0),this.viewer=e}cartesian2ToCartesian3(e){const{viewer:t}=this;let i=null;if(t&&e){const n=this.viewer.scene.drillPick(e);let s=!1;for(const o in n)if(!Number.isNaN(Number(o))){const r=n[o];if(s=r&&r.primitive instanceof g.A||r&&r.primitive instanceof w.A||r&&r.primitive instanceof y.A,s&&(t.scene.pick(e),i=t.scene.pickPosition(e),i)){const e=C.A.fromCartesian(i);e.height<0&&(e.height=0);const t=A.A.toDegrees(e.longitude),n=A.A.toDegrees(e.latitude),s=e.height;return i=this.lnglatToCartesian3(t,n,s),i}}if(!s){const n=t.terrainProvider instanceof b.A;if(!n){const n=t.scene.camera.getPickRay(e);return n?(i=t.scene.globe.pick(n,t.scene),i):null}if(i=t.scene.camera.pickEllipsoid(e,t.scene.globe.ellipsoid),i){const e=this.cartesian3ToLngLat(i);return e&&e.height<0&&(i=this.lnglatToCartesian3(e.longitude,e.latitude,.1)),i}}}return i}cartesian2ToLnglat(e){const t=this.cartesian2ToCartesian3(e),i=this.cartesian3ToLngLat(t);return i}cartesian3ToCartesian2(e){return T.A.wgs84ToWindowCoordinates(this.viewer.scene,e)}computeViewerBounds(){const e=this.scene.camera.computeViewRectangle();let t=[];if("undefined"===typeof e){const e=(e,t,i)=>{const{camera:n,scene:s}=e,o=new L.A(t,i),r=s.globe.ellipsoid,a=n.pickEllipsoid(o,r);if(a){const e=s.globe.ellipsoid.cartesianToCartographic(a),t=A.A.toDegrees(e.longitude),i=A.A.toDegrees(e.latitude);return{lon:t,lat:i}}},i=this.scene.canvas,n=e(this,0,0),s=e(this,i.clientWidth,i.clientHeight);n?.lon&&n?.lat&&s?.lon&&s?.lat&&(t=[n.lon,n.lat,s.lon,s.lat])}else t=[A.A.toDegrees(e.west),A.A.toDegrees(e.south),A.A.toDegrees(e.east),A.A.toDegrees(e.north)];return t}isVisibleByBounds(e){let t=!1;const i=this.computeViewerBounds();if(i){const n=this.cartesian3ToLngLat(e);if(n){const e=n.longitude,s=n.latitude;e>=i[0]&&e<=i[2]&&s>=i[1]&&s<=i[3]&&(t=!0)}}return t}cartesian3ToLngLat(e){if(e){const t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=A.A.toDegrees(t.latitude),n=A.A.toDegrees(t.longitude),s=t.height;return{longitude:n,latitude:i,height:s}}}}class M{constructor(e,t){(0,f.A)(this,"viewer",void 0),(0,f.A)(this,"element",void 0),(0,f.A)(this,"options",void 0),(0,f.A)(this,"cameraMoveEnd",void 0),(0,f.A)(this,"moving",!1),(0,f.A)(this,"postRender",void 0),(0,f.A)(this,"coord",void 0),this.viewer=e,this.coord=new x(e),this.options=t,this.element=this.options?.element,this.addCameraLisener(),this.addMapListener()}setPosition(e){if(this.viewer&&e){const t=this.coord.cartesian3ToCartesian2(e),{element:i}=this;if(i&&t){let e=t.x-i.clientWidth/2,n=t.y-i.clientHeight-15;this.options?.popPosition&&("leftbottom"===this.options?.popPosition?(e=t.x,n=t.y-i.clientHeight):"leftmiddle"===this.options?.popPosition&&(e=t.x+20,n=t.y-i.clientHeight/2)),i.style.display="block",i.style.left=`${e}px`,i.style.top=`${n}px`}this.options&&(this.options.position=e)}}addCameraLisener(){this.options?.visibleMaxCameraHeight&&(this.cameraMoveEnd=this.viewer?.camera.moveEnd.addEventListener((()=>{const e=this.viewer?.camera.getMagnitude(),t=6375e3;e&&this.options?.visibleMaxCameraHeight&&this.element&&(e-t>this.options.visibleMaxCameraHeight?this.hide():this.show())})))}hide(){this.element&&(this.element.style.visibility="hidden")}show(){this.element&&(this.element.style.visibility="visible")}destory(){this.cameraMoveEnd&&this.cameraMoveEnd(),this.postRender&&this.postRender()}addMapListener(){this.postRender=this.viewer?.scene.postRender.addEventListener((()=>{const e=this.options?.position;e&&(this.options?.renderInViewBounds?this.coord.isVisibleByBounds(e)?(this.moving||this.setPosition(e),"hidden"!==this.element?.style.visibility&&this.show()):this.hide():this.moving||this.setPosition(e))}))}}class k{constructor(e,t){(0,f.A)(this,"viewer",void 0),(0,f.A)(this,"element",void 0),(0,f.A)(this,"popup",void 0),this.viewer=e,this.init(t)}render(e,t,i){const s=n.Ay.extend(e),o=new s({propsData:i}),r=o.$mount().$el;t.appendChild(r)}init(e){const{component:t,position:i,popupCommonOption:n,props:s}=e,o=document.createElement("div");o.style.position="absolute",o.className="popup",this.element=o,t&&this.render(t,o,s),this.viewer.container.appendChild(o),this.popup=new M(this.viewer,{...n,element:o,position:i})}remove(){this.element&&this.viewer.container.removeChild(this.element),this.popup?.destory(),this.element=null}}var _=function(){var e=this,t=e._self._c;return t("div",{staticClass:"test"},[t("div",[e._v(" 我是测试弹窗vue3 ")]),t("div",[e._v(" 这里写入弹窗内容:"+e._s(e.id)+" ")]),t("div",{on:{click:e.click}},[e._v(" 关闭 ")])])},D=[],P={props:{id:String,close:Function},methods:{click(){this.close&&this.close()}}},E=P,R=(0,l.A)(E,_,D,!1,null,null,null),O=R.exports;let $,S,B;var H={components:{},mounted(){this.init()},methods:{async init(){if(this.$refs.mapRef){$=new Cesium.Viewer(this.$refs.mapRef,{baseLayer:Cesium.ImageryLayer.fromProviderAsync(this.tdtLayer()),terrainProvider:await Cesium.CesiumTerrainProvider.fromUrl("https://data.mars3d.cn/terrain"),infoBox:!1,selectionIndicator:!1,animation:!1,timeline:!1,baseLayerPicker:!1});const{longitude:e,latitude:t,height:i}={height:66.31026938893555,latitude:28.143662686652874,longitude:113.62423548410626};$.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e,t,1e3)});const{scene:n}=$,s=new Cesium.ScreenSpaceEventHandler(n.canvas);s.setInputAction((e=>{const t=new Coord($).cartesian2ToLnglat(e.position);console.log(t)}),Cesium.ScreenSpaceEventType.MIDDLE_CLICK);const o=Cesium.Cartesian3.fromDegrees(e,t,i),r=Cesium.Cartesian3.fromDegrees(113.6272273497165,28.143980467030072,71.92652572119125),a={component:O,position:o,props:{id:1,close:()=>{S.remove()}}};S=new k($,a);const l={component:O,position:r,props:{id:2,close:()=>{B.remove()}}};B=new k($,l)}},tdtLayer(){const e="img",t="c",i=`${e}_${t}`,n="4267820f43926eaf808d61dc07269beb",s=`http://{s}.tianditu.gov.cn/${i}/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=${e}&tileMatrixSet=${t}&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=${n}`;return new Cesium.WebMapTileServiceImageryProvider({url:s,layer:e,style:"default",format:"tiles",tileMatrixSetID:t,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],tilingScheme:new Cesium.GeographicTilingScheme,tileMatrixLabels:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],maximumLevel:50})}}},I=H,V=(0,l.A)(I,m,v,!1,null,"27cf3c20",null),j=V.exports,N={components:{CesiumMap:j}},W=N,F=(0,l.A)(W,d,p,!1,null,null,null),G=F.exports,q=[{path:"/",component:G}];n.Ay.use(u.Ay);const K=new u.Ay({routes:q});n.Ay.config.productionTip=!1,new n.Ay({el:"#app",router:K,render:e=>e(h)})}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=e,function(){var e=[];i.O=function(t,n,s,o){if(!n){var r=1/0;for(h=0;h<e.length;h++){n=e[h][0],s=e[h][1],o=e[h][2];for(var a=!0,l=0;l<n.length;l++)(!1&o||r>=o)&&Object.keys(i.O).every((function(e){return i.O[e](n[l])}))?n.splice(l--,1):(a=!1,o<r&&(r=o));if(a){e.splice(h--,1);var c=s();void 0!==c&&(t=c)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[n,s,o]}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,o,r=n[0],a=n[1],l=n[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(s in a)i.o(a,s)&&(i.m[s]=a[s]);if(l)var h=l(i)}for(t&&t(n);c<r.length;c++)o=r[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(h)},n=self["webpackChunkcesium_popup_vue2"]=self["webpackChunkcesium_popup_vue2"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[504],(function(){return i(5737)}));n=i.O(n)})();
//# sourceMappingURL=app.6c4ed2b6.js.map